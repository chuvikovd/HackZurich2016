{"version":3,"sources":["database.ts"],"names":[],"mappings":";AAAA,IAAY,IAAI,WAAM,QAAQ,CAAC,CAAA;AAI/B;IAKI,kBAAY,QAAQ;QALxB,iBA4CC;QApBG,eAAU,GAAG,UAAC,OAAgB;YAC1B,KAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;YAC9B,KAAI,CAAC,IAAI,EAAE,CAAC;QAChB,CAAC,CAAA;QAED,gBAAW,GAAG,UAAC,GAAW,EAAE,IAAY,EAAE,IAAY,EAAE,KAAa;YACjE,IAAI,GAAG,GAAG,KAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,UAAC,GAAY;gBACvC,MAAM,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,GAAG,GAAC,IAAI;oBACxB,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,GAAG,GAAC,IAAI;oBACxB,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,GAAC,KAAK;oBAC3B,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,GAAC,KAAK,CAAC,CAAC;YACzC,CAAC,CAAC,CAAC;YAEH,MAAM,CAAC,GAAG,CAAC;QACf,CAAC,CAAA;QAED,SAAI,GAAG;YACH,KAAI,CAAC,EAAE,CAAC,YAAY,EAAE,CAAC;QAC3B,CAAC,CAAA;QApCG,IAAI,CAAC,EAAE,GAAG,IAAI,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAErC,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,EAAE,EAAE;YACrB,IAAI,QAAQ,GAAG,KAAI,CAAC,EAAE,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;YACjD,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACZ,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;gBACrC,KAAI,CAAC,QAAQ,GAAG,KAAI,CAAC,EAAE,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;YACtD,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,OAAO,CAAC,GAAG,CAAC,2BAA2B,CAAC,CAAC;gBACzC,KAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;YAC7B,CAAC;YACD,KAAI,CAAC,IAAI,EAAE,CAAC;YACZ,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;YACzB,QAAQ,EAAE,CAAC;QACf,CAAC,CAAC,CAAC;IAEP,CAAC;IAsBL,eAAC;AAAD,CA5CA,AA4CC,IAAA;AA5CY,gBAAQ,WA4CpB,CAAA","file":"database.js","sourcesContent":["import * as loki from 'lokijs';\r\nimport {Message} from '../client/models/Message';\r\nimport {User} from '../client/models/User';\r\n\r\nexport class Database {\r\n    db: any;\r\n    messages: any;\r\n\r\n\r\n    constructor(callback) {\r\n        this.db = new loki('data/data.json');\r\n\r\n        this.db.loadDatabase({}, () => {\r\n            let messages = this.db.getCollection('messages');\r\n            if (!messages) {\r\n                console.log('adding new collection');\r\n                this.messages = this.db.addCollection('messages');\r\n            } else {\r\n                console.log('found existing collection');\r\n                this.messages = messages;\r\n            }\r\n            this.save();\r\n            console.log('DB LOADED');\r\n            callback();\r\n        });\r\n\r\n    }\r\n\r\n    addMessage = (message: Message) => {\r\n        this.messages.insert(message);\r\n        this.save();\r\n    }\r\n\r\n    getMessages = (lat: number, long: number, latX: number, longX: number) => {\r\n        let msg = this.messages.where((msg: Message) => {\r\n            return (msg.user.lat >= lat-latX &&\r\n                    msg.user.lat <= lat+latX &&\r\n                    msg.user.long >= long-longX &&\r\n                    msg.user.long <= long+longX);\r\n        });\r\n\r\n        return msg;\r\n    }\r\n\r\n    save = () => {\r\n        this.db.saveDatabase();\r\n    }\r\n\r\n}"],"sourceRoot":"/source/"}